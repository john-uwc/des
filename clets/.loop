#!/usr/bin/env bash

# author: steven, date:2018.3.16
# hook routine to handle cli event

# hint event for prompt
export PS1="\033[0m\u@\h: \033[33m(es>>${_psi:="-i-"}\033[33m)\033[36m\W\033[0m \$ "
function _hint_loop(){
local hints=$(_dw_query "hint")
local st="\033[32m$(map $hints get a.ts)\033[33m:\033[35m$(map $hints get st.vc)"
export PS1=${PS1/"$_psi"/$st}
_psi=$st
}

# fs event
function _fs_loop(){
local cs=$(_dw_query "vc")
if [ "$cs" != $(vc_cs) ]; then
_invoke_2c unalias "$cs"; cs=$(vc_cs); _invoke_2c alias "$cs=vc $cs"
fi
_dw_store "vc" "$cs"
}

# vc event
function _vc_loop(){
local cs=$(_dw_query "vc");
hint "st.vc" $cs\'$(__vc_st_$cs)
}

# ts event
function _ts_loop(){
local envrp=$(_dw_query "path.env.rp")
local tsc=","; local tss=""
local e
for e in $(map $(_dw_query ts) eset); do
tss="$tss:$(pair v $e)"
tsc="$tsc$(pair k $e),"
done
export PATH=$envrp$tss && hint "a.ts" $tsc
}
